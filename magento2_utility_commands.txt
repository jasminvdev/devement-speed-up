Magento 2 Developer Utility Commands
==============================================================

‚úÖ Setup & Deployment
--------------------------------------------------------------
# Run setup without maintenance
php bin/magento setup:upgrade --keep-generated
php bin/magento setup:upgrade
php bin/magento setup:di:compile
php bin/magento setup:static-content:deploy -f
php bin/magento setup:static-content:deploy -f en_GB
php bin/magento indexer:reindex
php bin/magento cache:clean
php bin/magento cache:flush

‚öôÔ∏è Deployment Modes
--------------------------------------------------------------
php bin/magento deploy:mode:show
php bin/magento deploy:mode:set developer
php bin/magento deploy:mode:set production
php bin/magento deploy:mode:set production --skip-compilation

üß© Maintenance Mode
--------------------------------------------------------------
php bin/magento maintenance:enable --ip=103.240.208.93 --ip=103.250.188.115
php bin/magento maintenance:enable
php bin/magento maintenance:disable
php bin/magento maintenance:status

üëâ Admin User Create Command
php bin/magento admin:user:create --admin-user=jasmin --admin-password=jasmin321 --admin-email=jasminvaghela14@gmail.com --admin-firstname=Jasmin --admin-lastname=Vaghela

üëâ Combined Command
php bin/magento maintenance:enable && php bin/magento setup:upgrade && php bin/magento setup:di:compile && php bin/magento setup:static-content:deploy -f && php bin/magento maintenance:disable

üåê Show Base URL
--------------------------------------------------------------
php bin/magento config:show web/secure/base_url

üóúÔ∏è Backup & Restore (Files)
--------------------------------------------------------------
tar --exclude='public_html/pub' -czf html-backup-$(date +%F).tar.gz public_html/
tar -zxvf html-backup-2025-06-06.tar.gz

üóÑÔ∏è Database Backup & Restore
--------------------------------------------------------------
mysqldump --opt --skip-lock-tables --routines --max_allowed_packet=2G -u <user_name> -p <database_name> | gzip > database-<project_name>-backup-$(date +%F).sql.gz
gunzip < <file_name>.sql.gz | sudo mysql -u <user_name> -p <database_name>
zcat <file_name>.sql.gz | sed -e 's/DEFINER[ ]*=[ ]*[^*]*\*/\*/' | sudo mysql -u <user_name> -p <database_name>


üöÄ File Upload to Server
--------------------------------------------------------------
scp html-backup-2025-11-10.tar.gz root@77.68.94.54:/var/www/vhosts/5msdevops.co.uk/elegant-villani.77-68-94-54.plesk.page
Example: scp -P 22 html-backup-2025-06-06.tar.gz root@69.62.***.**:/home/user/

üíª Live to Local Setup Steps
--------------------------------------------------------------
# On Live Server
cd /var/www/magento_path
mysqldump --opt --skip-lock-tables --routines --max_allowed_packet=2G -u new -p new | gzip > database-un-backup-$(date +%F).sql.gz
J2m8NaNHZ4pmUzP
tar --exclude='public_html/var/log' --ignore-failed-read -czf html-backup-$(date +%F).tar.gz public_html/
tar --exclude='public_html/var/log' -czf html-backup-$(date +%F).tar.gz public_html/
mv html-backup-*.tar.gz public_html/pub

# On Local Machine
cd /var/www/html/
mkdir project_name && cd project_name
wget https://site_url/html-backup-<something>.tar.gz
tar -zxvf html-backup-<something>.tar.gz
cd project_name

# Database
sudo mysql
CREATE DATABASE <database_name>;
exit
gunzip < <file_name>.sql.gz | sudo mysql -u <user_name> -p <database_name>

# Update URLs
php bin/magento config:set web/secure/base_url 'http://dev.site_url.local/'
php bin/magento config:set web/unsecure/base_url 'http://dev.site_url.local/'
php bin/magento config:set web/secure/use_in_frontend 0
php bin/magento config:set web/secure/use_in_adminhtml 0
php bin/magento deploy:mode:set developer

üåç Nginx Configuration
--------------------------------------------------------------
sudo nano /etc/nginx/sites-available/<filename>
upstream fastcgi_backend_sitename {
    server unix:/run/php/php8.1-fpm.sock;
}
server {
    listen 80;
    server_name dev.sitename.local;
    set $MAGE_ROOT /var/www/html/magento_path;
    include /var/www/html/magento_path/nginx.conf.sample;
}
sudo ln -s /etc/nginx/sites-available/<filename> /etc/nginx/sites-enabled/
sudo nano /etc/hosts
127.0.0.1 dev.sitename.local


sudo systemctl restart nginx
sudo systemctl restart php8.1-fpm
sudo systemctl restart mysql

üîÅ Extra Recommended Commands
--------------------------------------------------------------
# Permissions
find . -type f -exec chmod 644 {} \;
find . -type d -exec chmod 755 {} \;
find ./var -type d -exec chmod 777 {} \;
find ./generated -type d -exec chmod 777 {} \;
find ./pub/media -type d -exec chmod 777 {} \;
find ./pub/static -type d -exec chmod 777 {} \;
chmod 777 ./app/etc
chmod 644 ./app/etc/*.xml
chmod u+x bin/magento

# Cron Jobs
php bin/magento cron:install
php bin/magento cron:run

# Cache Warm-Up
php bin/magento cache:enable
php bin/magento cache:status



üîº Magento Upgrade Process
--------------------------------------------------------------
mkdir backup
zip -r app-vendor-backup.zip app/ vendor/ composer.json composer.lock
mv app-vendor-backup.zip backup/
php bin/magento maintenance:enable
mysqldump -u <user_name> -p <database_name> > backup/database-backup-$(date +%F).sql
composer require magento/product-community-edition 2.4.8-p1 --no-update
/opt/plesk/php/8.1/bin/php /usr/local/psa/var/modules/composer/composer.phar require magento/product-community-edition 2.4.6-p3 --no-update
composer remove <module_name>
composer require <module_name>
php bin/magento maintenance:disable

üîß Module Update Example
--------------------------------------------------------------
composer require hyva-themes/magento2-default-theme:1.3.19
composer require hyva-themes/magento2-default-theme:1.3.19 -w




‚ö° Speed up Development commands

function pr($object = "Comes here",$exit=1)
{
    echo "<pre>";
    print_r($object);
    echo "</pre>";
    if($exit)
        exit();
}
function c($object, $exit=1)
{
    if(is_array($object))
    {
        echo "<pre>";
        print_r("Its an array");
        echo "</pre>";
    }elseif(is_string($object)){
        echo "<pre>";
        print_r("It is a string");
        echo "</pre>";
    }else{
        echo "<pre>";
        print_r(get_class($object));
        echo "</pre>";
    }
    if($exit)
        exit();
}
function cm($object, $exit=1)
{
    if(is_array($object))
    {
        echo "<pre>";
        print_r("Its an array");
        echo "</pre>";
    }elseif(is_string($object)){
        echo "<pre>";
        print_r("It is a string");
        echo "</pre>";
    }else{
        echo "<pre>";
        print_r(get_class($object));
        print_r(get_class_methods($object));
        echo "</pre>";
    }
    if($exit)
        exit();
}
function t($exit=1)
{
    $stacks     = debug_backtrace();
    $output = "";
    foreach($stacks as $_stack)
    {
        if (!isset($_stack['file'])) $_stack['file'] = '[PHP Kernel]';
        if (!isset($_stack['line'])) $_stack['line'] = '';
 
        $output .=  "{$_stack["file"]} => {$_stack["line"]} => {$_stack["function"]}".PHP_EOL;
    }
    // return $output;
    echo "<pre>";
    print_r($output);
    echo "</pre>";
}
function invilog($var,$filename = "logFileName.log",$permission='a+'){
    
    $filename = (empty($filename)) ? "logFileName.log": $filename;
    $permission=(empty($permission)) ? "a+": $permission;
    $om = \Magento\Framework\App\ObjectManager::getInstance();
    $directory = $om->get('\Magento\Framework\Filesystem\DirectoryList');
    $rootPath  =  $directory->getRoot();
    $file = fopen($rootPath."/var/log/".$filename,$permission);
    fwrite($file,json_encode($var)."\n");
    fclose($file);
}
